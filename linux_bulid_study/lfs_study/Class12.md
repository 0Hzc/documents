### ğŸš€ ç¬¬åäºŒè¯¾ï¼šæ‰¹é‡åˆ¶é€  â€”â€” å‰©ä½™å·¥å…·çš„å¤§æ‰«è¡ (The Grand Finale of Temp Tools)

ä¸ºäº†é¿å…è®©ä½ å†™ 10 ä¸ªé‡å¤çš„è„šæœ¬ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•åˆ©ç”¨ **Shell æ•°ç»„** å’Œ **Case è¯­å¥** æ¥ç¼–å†™ä¸€ä¸ª**é€šç”¨æ„å»ºå¼•æ“**ã€‚

æˆ‘ä»¬å°†ä¸€æ¬¡æ€§ç¼–è¯‘ä»¥ä¸‹ 10 ä¸ªå…³é”®å·¥å…·ï¼š

1. **Diffutils** (æ¯”è¾ƒæ–‡ä»¶å·®å¼‚)
2. **File** (æŸ¥çœ‹æ–‡ä»¶ç±»å‹)
3. **Findutils** (æŸ¥æ‰¾æ–‡ä»¶)
4. **Gawk** (æ–‡æœ¬å¤„ç†)
5. **Grep** (æ–‡æœ¬æœç´¢)
6. **Gzip** (å‹ç¼©)
7. **Patch** (æ‰“è¡¥ä¸)
8. **Sed** (æµç¼–è¾‘)
9. **Tar** (æ‰“åŒ…)
10. **Xz** (å‹ç¼©)

#### æ ¸å¿ƒé€»è¾‘ï¼šé€šç”¨æ„å»ºå‡½æ•°

ç»å¤§å¤šæ•°è½¯ä»¶åŒ…çš„æ„å»ºæµç¨‹éƒ½æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼š
`configure --prefix=/usr --host=$LFS_TGT` -> `make` -> `make install`ã€‚

æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå‡½æ•° `build_generic`ï¼Œç„¶åæŠŠç‰¹æ®Šçš„é…ç½®å‚æ•°é€šè¿‡ `case` è¯­å¥ä¼ è¿›å»ã€‚

---

### ğŸ› ï¸ ä»»åŠ¡åäºŒï¼šç¼–å†™æ‰¹é‡æ„å»ºè„šæœ¬

è¯·ç¼–å†™è„šæœ¬ `build_remaining_tools.sh`ã€‚è¿™æ˜¯ä¸€ä¸ªè€ƒéªŒä½  Shell ç¼–ç¨‹èƒ½åŠ›çš„è„šæœ¬ã€‚

**è„šæœ¬é€»è¾‘éœ€æ±‚ï¼š**

1. **å‡†å¤‡å·¥ä½œ**ï¼š(Root ç”Ÿæˆ -> LFS è¿è¡Œ)ã€‚
2. **å®šä¹‰åˆ—è¡¨**ï¼š
* å®šä¹‰ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŒ…åçš„åˆ—è¡¨ï¼ˆæ•°ç»„æˆ–å­—ç¬¦ä¸²ï¼‰ï¼Œä¾‹å¦‚ï¼š`diffutils file findutils gawk grep gzip patch sed tar xz`ã€‚


3. **æ„å»ºå¾ªç¯**ï¼š
* éå†åˆ—è¡¨ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªåŒ…ï¼š
1. **è‡ªåŠ¨è§£å‹**ï¼šæ ¹æ®åŒ…åæ‰¾åˆ°å¯¹åº”çš„ `tar.gz` æˆ– `tar.xz`ã€‚
2. **ç‰¹æ®Šå¤„ç† (Caseè¯­å¥)**ï¼š
* å¤§éƒ¨åˆ†åŒ…çš„é…ç½®å‚æ•°æ˜¯é€šç”¨çš„ã€‚
* **Findutils** éœ€è¦ç‰¹æ®Šå‚æ•°ï¼š`--localstatedir=/var/lib/locate`ã€‚
* **Tar** å’Œ **Xz**ï¼šæ²¡æœ‰ä»»ä½•ç‰¹æ®Šè¦æ±‚ï¼Œæ ‡å‡†çš„ configure å³å¯ã€‚


3. **æ‰§è¡Œé…ç½®**ï¼šè¿è¡Œ `configure`ã€‚
4. **ç¼–è¯‘å®‰è£…**ï¼šè¿è¡Œ `make DESTDIR=$LFS install`ã€‚
5. **æ¸…ç†**ï¼šåˆ é™¤æºç ç›®å½•ã€‚




4. **éªŒè¯**ï¼š
* æ£€æŸ¥ `tar`, `sed`, `grep` ç­‰å‘½ä»¤æ˜¯å¦å­˜åœ¨ã€‚



**ä¸ºäº†ç¡®ä¿ä½ èƒ½é¡ºåˆ©å®Œæˆï¼Œæˆ‘æä¾›ä¸€ä»½åŸºäº Case è¯­å¥çš„è„šæœ¬æ¡†æ¶ã€‚è¯·ä»”ç»†é˜…è¯»å¹¶ç†è§£å…¶ä¸­çš„é€»è¾‘ï¼Œç„¶åç”Ÿæˆå¹¶è¿è¡Œå®ƒã€‚**

```bash
#!/bin/bash
set -e

# 1. Root èº«ä»½æ£€æŸ¥
if [ "${UID}" -ne 0 ]; then
    echo "è¯·ä½¿ç”¨ sudo è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

cat > /home/lfs/build_remaining_tools.sh <<EOF
#!/bin/bash
set -e

# --- èº«ä»½æ£€æŸ¥ ---
if [ "\$(whoami)" != "lfs" ]; then
    echo "è¯·åˆ‡æ¢åˆ° lfs ç”¨æˆ·è¿è¡Œï¼"
    exit 1
fi

# --- å®šä¹‰è¦ç¼–è¯‘çš„åŒ…åˆ—è¡¨ (é¡ºåºä¸æ•æ„Ÿï¼Œä½†å»ºè®®æŒ‰å­—æ¯åº) ---
# æ³¨æ„ï¼šè¿™é‡Œå†™çš„åå­—å¿…é¡»èƒ½åŒ¹é…åˆ° sources ä¸‹çš„å‹ç¼©åŒ…å
# ä¾‹å¦‚å†™ "grep"ï¼Œè„šæœ¬è¦èƒ½æ‰¾åˆ° "grep-3.11.tar.xz"
PACKAGES="diffutils file findutils gawk grep gzip patch sed tar xz"

cd \$LFS/sources

# --- å®šä¹‰é€šç”¨æ„å»ºå‡½æ•° ---
build_package() {
    local pkg=\$1
    echo "======================================="
    echo "ğŸ”¨ æ­£åœ¨å¤„ç†: \$pkg"
    echo "======================================="

    # 1. è‡ªåŠ¨å¯»æ‰¾å‹ç¼©åŒ…
    # ls \$pkg-*.tar.* ä¼šæ‰¾åˆ°å¯¹åº”çš„åŒ…ï¼Œhead -n1 ç¡®ä¿åªå–ä¸€ä¸ª
    local tarball=\$(ls \$pkg-*.tar.* | head -n1)
    
    if [ -z "\$tarball" ]; then
        echo "âŒ é”™è¯¯ï¼šæœªæ‰¾åˆ° \$pkg çš„æºç åŒ…ï¼"
        exit 1
    fi

    echo "ğŸ“¦ æ‰¾åˆ°æºç åŒ…: \$tarball"
    
    # 2. è§£å‹
    # è¿™é‡Œçš„ \${tarball%.tar.*} æ˜¯ä¸ºäº†å»é™¤åç¼€ï¼Œæ‹¿åˆ°ç›®å½•å
    # ä½†æœ‰äº›åŒ…è§£å‹å‡ºæ¥çš„ç›®å½•åä¸å¸¦ç‰ˆæœ¬å·ï¼Œæˆ–è€…å¸¦äº†ä¸åŒçš„åç¼€
    # æœ€ç¨³å¦¥çš„æ–¹å¼æ˜¯ï¼šå…ˆ tarï¼Œç„¶å find maxdepth 1 æ‰¾åˆ°åˆšç”Ÿæˆçš„ç›®å½•
    # ä½†ä¸ºäº†è„šæœ¬ç®€å•ï¼Œæˆ‘ä»¬å‡è®¾è§£å‹å‡ºæ¥çš„ç›®å½•åæ˜¯æ–‡ä»¶åå»æ‰ .tar.xz/.gz
    local dirname=""
    if [[ "\$tarball" == *.tar.xz ]]; then
        dirname=\${tarball%.tar.xz}
    elif [[ "\$tarball" == *.tar.gz ]]; then
        dirname=\${tarball%.tar.gz}
    fi
    
    # æ¸…ç†æ—§ç›®å½•
    if [ -d "\$dirname" ]; then rm -rf "\$dirname"; fi

    tar -xf "\$tarball"
    cd "\$dirname"

    # 3. é…ç½® (Configure)
    # é»˜è®¤å‚æ•°
    local config_args="--prefix=/usr --host=\$LFS_TGT --build=\$(./build-aux/config.guess 2>/dev/null || ./config.guess)"

    # --- ç‰¹æ®Šå¤„ç†åŒº (Switch Case) ---
    case \$pkg in
        findutils)
            # Findutils éœ€è¦æŒ‡å®š locate æ•°æ®åº“ä½ç½®
            config_args="\$config_args --localstatedir=/var/lib/locate"
            ;;
        gzip)
            # Gzip æ¯”è¾ƒè€ï¼Œå®ƒçš„ configure è„šæœ¬é‡Œæ²¡æœ‰ config.guessï¼Œä¸ç”¨ä¼  --build
            config_args="--prefix=/usr --host=\$LFS_TGT"
            ;;
        *)
            # å…¶ä»–åŒ…ä½¿ç”¨é»˜è®¤å‚æ•°å³å¯
            ;;
    esac

    echo "âš™ï¸ é…ç½®å‚æ•°: \$config_args"
    ./configure \$config_args

    # 4. ç¼–è¯‘ä¸å®‰è£…
    echo "ğŸ—ï¸ ç¼–è¯‘ä¸­..."
    make -j\$(nproc)
    
    echo "ğŸ’¾ å®‰è£…ä¸­..."
    make DESTDIR=\$LFS install

    # 5. æ¸…ç†
    cd ..
    rm -rf "\$dirname"
    echo "âœ… \$pkg æ„å»ºå®Œæˆï¼"
}

# --- å¾ªç¯æ‰§è¡Œ ---
for p in \$PACKAGES; do
    build_package "\$p"
done

# --- æ·±åº¦éªŒè¯ ---
echo "---------------------------------------------------"
echo "ğŸ” æ­£åœ¨è¿›è¡Œæœ€ç»ˆéªŒè¯..."

failed=0
for tool in diff file find gawk grep gzip patch sed tar xz; do
    if [ -x "\$LFS/usr/bin/\$tool" ]; then
        echo "âœ… \$tool å·²å®‰è£…"
    else
        echo "âŒ \$tool ç¼ºå¤±ï¼"
        failed=1
    fi
done

if [ \$failed -eq 0 ]; then
    echo "ğŸ‰ æ‰€æœ‰å‰©ä½™å·¥å…·æ„å»ºå®Œæˆï¼ä¸´æ—¶ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼"
else
    echo "âŒ å­˜åœ¨æ„å»ºå¤±è´¥çš„å·¥å…·ï¼Œè¯·æ£€æŸ¥æ—¥å¿—ã€‚"
    exit 1
fi
echo "---------------------------------------------------"

EOF

# æƒé™ç§»äº¤
chown lfs:lfs /home/lfs/build_remaining_tools.sh
chmod +x /home/lfs/build_remaining_tools.sh

echo "è„šæœ¬ç”Ÿæˆå®Œæ¯•ã€‚è¯·è¿è¡Œï¼šsu - lfs ç„¶åæ‰§è¡Œ ./build_remaining_tools.sh"

```

---

### ğŸ”® å±•æœ›ï¼šä¸‹ä¸€è¯¾æ˜¯â€œå¤§ç»“å±€â€

è¿™ä¸ªè„šæœ¬è¿è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬çš„**ä¸´æ—¶ç³»ç»Ÿï¼ˆTemporary Systemï¼‰**å°±å½»åº•ç«£å·¥äº†ã€‚

ä¸‹ä¸€è¯¾ï¼ˆç¬¬åä¸‰è¯¾ï¼‰ï¼Œæˆ‘ä»¬å°†è¿æ¥ LFS è¿‡ç¨‹ä¸­æœ€æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼š
**Changing Root (chroot)**ã€‚

æˆ‘ä»¬å°†ç¦»å¼€ WSL çš„ Ubuntu å®¿ä¸»ç¯å¢ƒï¼Œåƒã€Šé»‘å®¢å¸å›½ã€‹é‡Œé‚£æ ·ï¼Œæ’ä¸Šç®¡å­ï¼Œç›´æ¥è¿›å…¥æˆ‘ä»¬åˆšåˆšäº²æ‰‹æ­å»ºçš„è¿™ä¸ª `/mnt/lfs` è¿·ä½ ç³»ç»Ÿå†…éƒ¨ã€‚

**ç°åœ¨ï¼Œè¯·å…ˆå®Œæˆè¿™æœ€åä¸€æ¬¡â€œæ‰¹é‡ç”Ÿäº§â€ä»»åŠ¡ï¼**