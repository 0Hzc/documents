### ğŸš€ ç¬¬åè¯¾ï¼šæµæ°´çº¿ä½œä¸š â€”â€” ä¸´æ—¶å·¥å…·çš„æ‰¹é‡ç”Ÿäº§ (M4 & Ncurses)

æ­å–œä½ ï¼éšç€ Libstdc++ çš„å®Œæˆï¼Œæˆ‘ä»¬å·²ç»è·¨è¶Šäº† LFS æœ€è‰°éš¾çš„â€œæ­»å¾ªç¯â€é˜¶æ®µï¼ˆç¼–è¯‘å™¨ç¼–è¯‘ç¼–è¯‘å™¨ï¼‰ã€‚ç°åœ¨çš„ä½ ï¼Œæ‹¥æœ‰äº†ä¸€å¥—å®Œæ•´çš„ã€ç‹¬ç«‹çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼š

  * **Binutils** (å¤„ç†äºŒè¿›åˆ¶)
  * **GCC + Glibc + Libstdc++** (ç¼–è¯‘ C/C++ ä»£ç )

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è¿›å…¥ **LFS ç¬¬å…­ç« ï¼šäº¤å‰ç¼–è¯‘ä¸´æ—¶å·¥å…· (Cross Compiling Temporary Tools)**ã€‚

#### 1\. è¿™ä¸€ç« åœ¨åšä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬è¦åˆ©ç”¨åˆšæ‰åšå¥½çš„å·¥å…·é“¾ï¼Œç¼–è¯‘å‡ºä¸€ç³»åˆ—åŸºç¡€è½¯ä»¶ï¼ˆå¦‚ Bash, Coreutils, Make, Grep ç­‰ï¼‰ã€‚
è¿™äº›è½¯ä»¶å°†è¢«å®‰è£…åœ¨ `/tools` ç›®å½•ä¸‹ã€‚
**ç›®çš„**ï¼šæ„å»ºä¸€ä¸ª**åŠŸèƒ½å®Œå¤‡çš„å¾®å‹ Linux ç³»ç»Ÿ**ï¼ˆä¸´æ—¶ç³»ç»Ÿï¼‰ã€‚ç­‰è¿™ä¸ªç³»ç»Ÿå®Œå–„äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ `chroot` è¿›å»ï¼ŒæŠŠå®ƒå½“ä½œçœŸæ­£çš„ç³»ç»Ÿæ¥ç”¨ã€‚

#### 2\. ä¸ºä»€ä¹ˆå«â€œæµæ°´çº¿â€ï¼Ÿ

ä»ç°åœ¨å¼€å§‹ï¼Œä½ ä¼šå‘ç°è„šæœ¬é€»è¾‘å˜å¾—**é«˜åº¦é‡å¤**ï¼š
`è§£å‹` -\> `mkdir build` -\> `configure` -\> `make` -\> `make install` -\> `æ¸…ç†`ã€‚

ä¸ºäº†é¿å…æ¯ä¸€è¯¾éƒ½é‡å¤å†™å‡ åè¡Œä»£ç ï¼Œæˆ‘ä»¬è¦å­¦ä¹ \*\*â€œé€šç”¨æ„å»ºæ¨¡æ¿â€\*\*çš„æ€ç»´ã€‚ä»Šå¤©æˆ‘ä»¬å…ˆæ‹¿ä¸¤ä¸ªç®€å•çš„å·¥å…·ç»ƒæ‰‹ï¼š**M4** å’Œ **Ncurses**ã€‚

  * **M4**ï¼šä¸€ä¸ªå®å¤„ç†å™¨ï¼Œç¼–è¯‘ Bisonï¼ˆè¯­æ³•åˆ†æå™¨ï¼‰æ—¶å¿…é¡»ç”¨å®ƒã€‚
  * **Ncurses**ï¼šå¤„ç†ç»ˆç«¯å±å¹•æ˜¾ç¤ºçš„åº“ï¼ˆæ¯”å¦‚ `menuconfig` ç•Œé¢æˆ– `nano` ç¼–è¾‘å™¨éƒ½è¦ç”¨åˆ°å®ƒï¼‰ã€‚

-----

### ğŸ› ï¸ ä»»åŠ¡åï¼šç¼–è¯‘ M4 å’Œ Ncurses

è¯·ç¼–å†™è„šæœ¬ `build_temp_tools_part1.sh`ã€‚

**è„šæœ¬é€»è¾‘éœ€æ±‚ï¼š**

1.  **å‡†å¤‡å·¥ä½œ**ï¼š(Root ç”Ÿæˆ -\> LFS è¿è¡Œ)ã€‚

2.  **ä»»åŠ¡ä¸€ï¼šç¼–è¯‘ M4**

      * **æºç åŒ…**ï¼š`m4-1.4.19.tar.xz` (ç‰ˆæœ¬å¯èƒ½ä¸åŒï¼Œä»¥ ls ä¸ºå‡†)ã€‚
      * **é…ç½®**ï¼š
        ```bash
        ./configure --prefix=/usr   \
                    --host=$LFS_TGT \
                    --build=$(build-aux/config.guess)
        ```
      * **å®‰è£…**ï¼š`make DESTDIR=$LFS install`
      * *æ³¨æ„ï¼šM4 ä¸æ”¯æŒåœ¨ build ç›®å½•ç¼–è¯‘ï¼Œç›´æ¥åœ¨æºç æ ¹ç›®å½•ç¼–è¯‘å³å¯ã€‚*

3.  **ä»»åŠ¡äºŒï¼šç¼–è¯‘ Ncurses**

      * **æºç åŒ…**ï¼š`ncurses-6.5.tar.gz`ã€‚
      * **é¢„å¤„ç†**ï¼šç¡®ä¿ `gawk` èƒ½å¤Ÿè¢«æ‰¾åˆ°ï¼ˆLFS ç¯å¢ƒä¸­é€šå¸¸æ²¡é—®é¢˜ï¼Œä½†ä¸ºäº†ä¿é™©ï¼‰ï¼š
        `sed -i s/mawk// configure`
      * **åˆ›å»ºæ„å»ºç›®å½•**ï¼š`mkdir build` -\> `cd build`ã€‚
      * **é…ç½®** (å‚æ•°è¾ƒå¤šï¼Œç›´æ¥å¤åˆ¶)ï¼š
        ```bash
        ../configure --prefix=/usr           \
                     --host=$LFS_TGT         \
                     --build=$(./config.guess) \
                     --mandir=/usr/share/man \
                     --with-manpage-format=normal \
                     --with-shared           \
                     --without-normal        \
                     --with-cxx-shared       \
                     --without-debug         \
                     --without-ada           \
                     --disable-stripping     \
                     --enable-widec
        ```
      * **å®‰è£…**ï¼š

       å…ˆæ‰§è¡Œ `make`

       åœ¨æ‰§è¡Œ `make DESTDIR=$LFS TIC_PATH=$(pwd)/build/progs/tic install`

      * *è§£é‡Š*ï¼š`TIC_PATH` æ˜¯ Ncurses ç‰¹æœ‰çš„å‚æ•°ï¼Œç”¨äºæŒ‡å®šç¼–è¯‘å¥½çš„ terminfo ç¼–è¯‘å™¨è·¯å¾„ã€‚
      * **ä¿®å¤åº“é“¾æ¥**ï¼š(Ncurses çš„ä¸€ä¸ªå†å²é—ç•™é—®é¢˜ï¼Œå¾ˆå¤šç¨‹åºæ‰¾ `libncurses.so` ä½†å®ƒç”Ÿæˆçš„æ˜¯ `libncursesw.so`)
        ```bash
        echo "INPUT(-lncursesw)" > $LFS/usr/lib/libncurses.so
        ```

4.  **æ¸…ç†**ï¼š

      * æ¯ç¼–è¯‘å®Œä¸€ä¸ªï¼Œéƒ½è¦åˆ é™¤æºç ç›®å½•ã€‚

**ğŸ’¡ æŒ‘æˆ˜**ï¼š
è¯·å°è¯•åœ¨ä¸€ä¸ªè„šæœ¬é‡Œè¿ç»­å®Œæˆè¿™ä¸¤ä¸ªè½¯ä»¶çš„ç¼–è¯‘ã€‚è¿™èƒ½é”»ç‚¼ä½ å¤„ç†â€œæ‰¹é‡ä»»åŠ¡â€çš„èƒ½åŠ›ã€‚

**è¯·ç¼–å†™ `build_temp_tools_part1.sh`ï¼**

**é—®é¢˜è®°å½•**
é—®é¢˜1ï¼šæ‰§è¡Œå®Œ./configureåï¼Œæ‰§è¡Œmakeå‡ºç°æŠ¥é”™
LFS ç¤¾åŒºéªŒè¯ä¿®å¤æ–¹æ¡ˆ (The "Sandwich" Patch)ï¼š
```shell
cd ..
rm -rf build
nano c++/etip.h.in
```
æ‰¾åˆ°#include <iostream>è¿™ä¸€è¡Œ
å°†ä»¥ä¸‹å†…å®¹å…¨éƒ¨æ›¿æ¢ï¼š
```c
#if !((defined(__GNUG__) && defined(__EXCEPTIONS) && (__GNUG__ < 7)) || defined(__SUNPRO_CC))

#  if HAVE_IOSTREAM

#     include <iostream>

#     if IOSTREAM_NAMESPACE

using std::cerr;

using std::endl;

#     endif

#  else

#     include <iostream.h>

#  endif

#endif
```
æ›¿æ¢æˆ
```c
#if !((defined(__GNUG__) && defined(__EXCEPTIONS) && (__GNUG__ < 7)) || defined(__SUNPRO_CC))
// [LFS ä¿®å¤å¼€å§‹] 
// 1. æ‘˜ä¸‹é¢å…·ï¼šå–æ¶ˆ bool å®šä¹‰ï¼Œè®© <iostream> èƒ½æ­£å¸¸è¯»å–
#undef bool
#undef TRUE
#undef FALSE

#include <iostream>

// 2. æˆ´å›é¢å…·ï¼šè®©åç»­ Ncurses ä»£ç ä»¥ä¸º bool è¿˜æ˜¯åŸæ¥çš„ unsigned char
// è¿™æ ·å°±è§£å†³äº† conflicting declaration æŠ¥é”™
#ifndef TRUE
#define TRUE (1)
#endif

#ifndef FALSE
#define FALSE (0)
#endif

#define bool NCURSES_BOOL

// 3. ä½¿ç”¨æ ‡å‡†å‘½åç©ºé—´ï¼Œé˜²æ­¢ cerr/endl æ‰¾ä¸åˆ°
using namespace std;
// [LFS ä¿®å¤ç»“æŸ]
#endif
```
ç„¶åé‡æ–°åˆ›å»ºbuildæ–‡ä»¶å¤¹ï¼Œå¹¶è¿›è¡Œ./configure

æ­¤æ—¶å¯ä»¥é¡ºåˆ©æ‰§è¡Œmake

makeæ‰§è¡Œå®Œå

æ‰§è¡Œmake DESTDIR=$LFS TIC_PATH=$(pwd)/build/progs/tic installï¼Œ

ä¼šåœ¨æœ€åä¸€æ­¥æŠ¥é”™ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼šæ‰‹åŠ¨ç”¨å®¿ä¸»æœº `tic` ç”Ÿæˆ

/usr/bin/tic -x -o $LFS/usr/share/terminfo ../misc/terminfo.src

æ— æŠ¥é”™ï¼Œåˆ™ncursesé¡ºåˆ©ç¼–è¯‘å®Œï¼Œå¯åˆ é™¤æ–‡ä»¶å¤¹äº†

åœ¨ç»ˆç«¯ä¸­ä¾æ¬¡è¿è¡Œï¼ˆå¤åˆ¶ç²˜è´´ï¼‰ä»¥ä¸‹å‘½ä»¤ï¼š

1. ç»´åº¦ä¸€ï¼šæ£€æŸ¥æ ¸å¿ƒâ€œé›¶ä»¶â€ (åº“æ–‡ä»¶ä¸å¤´æ–‡ä»¶)

ç¡®ä¿åº“æ–‡ä»¶éƒ½åœ¨ï¼Œä¸”é‚£ä¸ªæˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„â€œå‡æ›¿èº«â€ï¼ˆlinker scriptï¼‰å†…å®¹æ­£ç¡®ã€‚

```bash
# 1. æ£€æŸ¥æ˜¯å¦å­˜åœ¨å®½å­—ç¬¦ç‰ˆæœ¬çš„åŠ¨æ€åº“ (è¿™æ˜¯æœ¬ä½“)
ls -l $LFS/usr/lib/libncursesw.so.6* # é¢„æœŸï¼šåº”è¯¥åˆ—å‡ºæ–‡ä»¶ï¼Œè€Œä¸æ˜¯æŠ¥é”™ "No such file"

# 2. æ£€æŸ¥å¤´æ–‡ä»¶ (è¿™æ˜¯ç¼–è¯‘ Bash å¿…é¡»çš„)
ls -l $LFS/usr/include/ncurses.h
# é¢„æœŸï¼šåˆ—å‡ºæ–‡ä»¶

# 3. æ£€æŸ¥æˆ‘ä»¬æ‰‹åŠ¨å†™çš„é‚£ä¸ªâ€œæŒ‡è·¯ç‰Œâ€æ–‡ä»¶
cat $LFS/usr/lib/libncurses.so
# é¢„æœŸè¾“å‡ºï¼šINPUT(-lncursesw)

```

---

2. ç»´åº¦äºŒï¼šæ£€æŸ¥â€œæ•°æ®åº“â€ (Terminfo)

è¿™æ˜¯ä½ åˆšæ‰æ‰‹åŠ¨ç”¨å®¿ä¸»æœº `tic` ç”Ÿæˆçš„éƒ¨åˆ†ã€‚Bash éœ€è¦å®ƒæ¥æ­£ç¡®æ˜¾ç¤ºé¢œè‰²å’Œå…‰æ ‡ã€‚

```bash
# æ£€æŸ¥ä¸¤ä¸ªæœ€å¸¸ç”¨çš„ç»ˆç«¯å®šä¹‰
ls -d $LFS/usr/share/terminfo/x/xterm
ls -d $LFS/usr/share/terminfo/l/linux

```

**é¢„æœŸç»“æœ**ï¼šå¦‚æœä¸æŠ¥é”™å¹¶æ˜¾ç¤ºäº†è·¯å¾„ï¼Œè¯´æ˜æ•°æ®åº“ç»“æ„æ˜¯å®Œæ•´çš„ã€‚

---
